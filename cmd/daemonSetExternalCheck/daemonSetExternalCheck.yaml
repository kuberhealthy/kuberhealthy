apiVersion: comcast.github.io/v1
kind: KuberhealthyCheck
metadata:
  name: kh-daemonset-check
  namespace: kuberhealthy
spec:
  runInterval: 20m
  # Make sure this Kuberhealthy check timeout is GREATER THAN the daemonset checker timeout
  # set in the env var DS_CHECKER_TIMEOUT. Default is set to 5m (5 minutes).
  timeout: 18m
  extraAnnotations:
    comcast.com/testAnnotation: test.annotation
  extraLabels:
    testLabel: testLabel
  podSpec:
    containers:
      - env:
          - name: POD_NAMESPACE
            value: "kuberhealthy"
          - name: DS_CHECKER_TIMEOUT
            # Make sure this value is less than the Kuberhealthy check timeout.
            # Default is set to 10m (10 minutes).
            value: "15m"
        image: quay.io/comcast/kh-daemonset-check:1.0.0
        imagePullPolicy: Always
        name: main
        resources:
          requests:
            cpu: 10m
            memory: 50Mi
    serviceAccountName: daemonset-khcheck
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: daemonset-khcheck
  namespace: kuberhealthy
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: ds-admin
subjects:
  - kind: ServiceAccount
    name: daemonset-khcheck
    namespace: kuberhealthy
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: ds-admin
  namespace: kuberhealthy
rules:
  - apiGroups:
      - ""
      - extensions
      - app
    resources:
      - daemonsets
      - pods
    verbs:
      - create
      - delete
      - deletecollection
      - get
      - list
      - patch
      - update
      - watch
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: daemonset-khcheck
  namespace: kuberhealthy
secrets:
  - name: daemonset-khcheck-token-bjnxp
---
apiVersion: v1
data:
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMwekNDQWJ1Z0F3SUJBZ0lNRllPYzNkcEhvMENGMHE4ck1BMEdDU3FHU0liM0RRRUJDd1VBTUJVeEV6QVIKQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13SGhjTk1Ua3dNakV6TVRneU5qRXpXaGNOTWprd01qRXlNVGd5TmpFegpXakFWTVJNd0VRWURWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBCk1JSUJDZ0tDQVFFQXQ3Q3NGdkNOUXhTQVhSTzZnNmxzek9KM0hCZU9Gb1RaeUEvMFlOYkhzbnBnYVROc3JCZ2sKc1dWWVRRWmJtNWV4dU5wWXFxMVNuVThSMGxqZTArbEpPdmNkaHpKc0d4UHNNK2VSVzdrcEprZDVBS2JDQktTYQpYRVBYNGxRR3ZtV3F2UUxIcW9wbEZYanBjUmxKMWdlaE12Mm5pSnNER0I2d05WVWxkbktlR0FrTjVpV2ZaTmNRCmFKZDRSSDVHckVTWG5McGJvdFZOMTVnVHY4NUI2U0E0QjBwYUlKamtYcE1USWJmSk9lTFpOSTBlZDRUVWRvWkgKcG9lU0YzOTVnbnUxOWdDdWkybjg0ZmFJR0ZwTUhkam5WVTNIV084VnI0a3dvTTZNRThjQUltQ2c0bjY2OE9QVgpXOFlyUTZtQlMwWUxKUTZwMnRESk1yQ1pKdVlmd1BBZER3SURBUUFCb3lNd0lUQU9CZ05WSFE4QkFmOEVCQU1DCkFRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFqaEYvRGh4YVpjUzMKVS9iNWgrUk1qNWsva2lPL1hhMnJrM1Q3MXE4amhPdkh0elRnUG1DWG1YanVZYUFCTjBPYUNucTJRRGVyUys2QgpBOFZqajNuRnNZOE4vbzhxdzdPeWJQOFBleFMwSjhzOFhtUlFub3BLZ3BrRnRIdnZPSGlEMDlNMWxyako1TENYClBhTmVkM0F2dFRybmZPbnU4UW82bXdoQlkxWm5xY0FDajJ2c1dEWkdmTld5VnBMR0VWZVNtNEE3bVJ2cko0bHMKbWhwY3ZaVTBHcXl1cnpRMlhjdkVRVzBMdkQ4TVhBY0d6RUE3S1p2L0tveGNJdERsQ0ZqZjl2bVA2bnVPNVdzNApicG1xTllPMjcycHhadUFHZHRLZWVLUHo0MDhhckRXcU5IQWlhMFJuRDYzNWdmTjNxbmxMZmw4cFR5T0xORWhzCmFPT0RJWnB0K3c9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  namespace: a3ViZXJoZWFsdGh5
  token: ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNklpSjkuZXlKcGMzTWlPaUpyZFdKbGNtNWxkR1Z6TDNObGNuWnBZMlZoWTJOdmRXNTBJaXdpYTNWaVpYSnVaWFJsY3k1cGJ5OXpaWEoyYVdObFlXTmpiM1Z1ZEM5dVlXMWxjM0JoWTJVaU9pSnJkV0psY21obFlXeDBhSGtpTENKcmRXSmxjbTVsZEdWekxtbHZMM05sY25acFkyVmhZMk52ZFc1MEwzTmxZM0psZEM1dVlXMWxJam9pWkdGbGJXOXVjMlYwTFd0b1kyaGxZMnN0ZEc5clpXNHRZbXB1ZUhBaUxDSnJkV0psY201bGRHVnpMbWx2TDNObGNuWnBZMlZoWTJOdmRXNTBMM05sY25acFkyVXRZV05qYjNWdWRDNXVZVzFsSWpvaVpHRmxiVzl1YzJWMExXdG9ZMmhsWTJzaUxDSnJkV0psY201bGRHVnpMbWx2TDNObGNuWnBZMlZoWTJOdmRXNTBMM05sY25acFkyVXRZV05qYjNWdWRDNTFhV1FpT2lJNFpXTTVNalV5TVMxbU1UTTFMVEV4WlRrdFltSmxPUzB3TW1WbE1HSmhOR1kwTkRBaUxDSnpkV0lpT2lKemVYTjBaVzA2YzJWeWRtbGpaV0ZqWTI5MWJuUTZhM1ZpWlhKb1pXRnNkR2g1T21SaFpXMXZibk5sZEMxcmFHTm9aV05ySW4wLkduU3RjRThYc0d1M01WZ1FUQzdnZVhDYjhLRUN1aFlIRzVLbHBGOWZKWjNDblhjTDFmSHNodDNia0xfV0F6bzYwSDR1ZWdpR0lIblpyRnRWS0V5cnNKVXlQRTZYemxRVl80aXJ5TXpBWkh1UW1mMHVwbFIwSHB0UzkxNHk4Nk1SS0g1enlZV1JTQU1rTkZkbzBsekhPR0xUNnRiZTNpZkk3RU41dWpNOFpZMlJyelVKMWYyNFZsQlpTbVJXZTZPOTJ6dnk5TUFMa2ZUdU9wb18xaXgzZHhINjRlUWVzYlNHUXA3VWpmd0NCMnZNNWtiYlZkOGE5U3N6bjlpamJvMkREOXhfQ2FYc2l4SFk5R0xtYjZrT3hWNjg0ME1LemtmSUpDV1MwVjNGU2oxeWhYSXNrejJmSnBXOVM3UnJNYTdULUZUNlE0dTREUDRJbGF1WkdSZUZHZw==
kind: Secret
metadata:
  name: daemonset-khcheck-token-bjnxp
  namespace: kuberhealthy
type: kubernetes.io/service-account-token
