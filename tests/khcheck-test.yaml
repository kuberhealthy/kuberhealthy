apiVersion: kuberhealthy.github.io/v2
kind: KuberhealthyCheck
metadata:
  name: test
  namespace: kuberhealthy
spec:
  singleRunOnly: false
  runInterval: 15s
  timeout: 30s
  podSpec:
    spec:
      containers:
        - name: main
          image: curlimages/curl:8.5.0
          command:
            - sh
            - -c
            - |
              set -x
              report='{"OK":true,"Errors":[]}'
              echo "Reporting to $KH_REPORTING_URL with KH_RUN_UUID=$KH_RUN_UUID payload: $report"
              curl -v --fail-with-body \
                -H "Content-Type: application/json" \
                -H "kh-run-uuid: $KH_RUN_UUID" \
                -d "$report" "$KH_REPORTING_URL"
              echo "Report sent"
      restartPolicy: Never
